<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice - Apex Technologies</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="navbar">
            <div class="sitename">
                <h2><a href="index.html">APEX</a></h2>
                <div class="subtitle">TECHNOLOGY SHOP</div>
            </div>
            <nav>
                <ul id="MenuItems">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="products.html">Shop Now</a></li>
                    <li><a href="about.html">Contact</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="checkout-section">
        <div class="container">
            <h1 class="section-title">Invoice</h1>

            <div class="checkout-container">
                <div class="checkout-summary">
                    <h2>Invoice Details</h2>
                    <div id="invoiceHeader" class="checkout-totals"></div>
                    <div id="invoiceShipping" class="checkout-totals"></div>
                    <div id="invoiceTotals" class="checkout-totals"></div>
                </div>

                <div class="checkout-form-container">
                    <h2>Purchased Items</h2>
                    <div id="invoiceItems" class="checkout-items-list"></div>
                    <div class="checkout-actions-summary">
                        <button class="btn btn-primary" onclick="window.location.href='products.html'">Back to Shop</button>
                        <button class="btn btn-secondary" onclick="sendInvoiceToEmail()">Send to Email</button>
                        <button class="btn btn-outline" onclick="window.location.href='dashboard.html'">View Dashboard</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="script.js"></script>
    <script>
        // Load the last generated invoice from localStorage and display it
        document.addEventListener('DOMContentLoaded', function () {
            const invoiceData = localStorage.getItem('lastInvoice');
            if (!invoiceData) {
                document.getElementById('invoiceHeader').innerHTML = '<p>No invoice found. Please complete a checkout first.</p>';
                return;
            }

            const invoice = JSON.parse(invoiceData);

            const headerDiv = document.getElementById('invoiceHeader');
            const shippingDiv = document.getElementById('invoiceShipping');
            const totalsDiv = document.getElementById('invoiceTotals');
            const itemsDiv = document.getElementById('invoiceItems');

            headerDiv.innerHTML =
                '<div class="summary-item"><span>Company:</span><span>' + invoice.companyName + '</span></div>' +
                '<div class="summary-item"><span>Invoice Number:</span><span>' + invoice.invoiceNumber + '</span></div>' +
                '<div class="summary-item"><span>Date:</span><span>' + new Date(invoice.date).toLocaleString() + '</span></div>' +
                '<div class="summary-item"><span>TRN:</span><span>' + invoice.trn + '</span></div>';

            if (invoice.shippingInformation) {
                shippingDiv.innerHTML =
                    '<div class="summary-item"><span>Shipping Name:</span><span>' + invoice.shippingInformation.name + '</span></div>' +
                    '<div class="summary-item"><span>Address:</span><span>' + invoice.shippingInformation.address + '</span></div>' +
                    '<div class="summary-item"><span>City:</span><span>' + invoice.shippingInformation.city + '</span></div>' +
                    '<div class="summary-item"><span>Postal Code:</span><span>' + invoice.shippingInformation.postal + '</span></div>';
            }

            totalsDiv.innerHTML =
                '<div class="summary-item"><span>Subtotal:</span><span>$' + invoice.subtotal.toFixed(2) + '</span></div>' +
                '<div class="summary-item"><span>Discount:</span><span>$' + invoice.discount.toFixed(2) + '</span></div>' +
                '<div class="summary-item"><span>Tax:</span><span>$' + invoice.taxes.toFixed(2) + '</span></div>' +
                '<div class="summary-item total"><span>Total Cost:</span><span>$' + invoice.totalCost.toFixed(2) + '</span></div>' +
                '<div class="summary-item"><span>Amount Paid:</span><span>$' + invoice.amountPaid.toFixed(2) + '</span></div>';

            itemsDiv.innerHTML = '';
            if (Array.isArray(invoice.items) && invoice.items.length > 0) {
                for (let i = 0; i < invoice.items.length; i++) {
                    const item = invoice.items[i];
                    const row = document.createElement('div');
                    row.className = 'checkout-item';
                    const itemTotal = item.price * item.quantity;
                    row.innerHTML =
                        '<div class="checkout-item-info"><h4>' + item.name + '</h4>' +
                        '<p>Quantity: ' + item.quantity + ' Ã— $' + item.price.toFixed(2) + '</p></div>' +
                        '<div class="checkout-item-price">$' + itemTotal.toFixed(2) + '</div>';
                    itemsDiv.appendChild(row);
                }
            } else {
                itemsDiv.innerHTML = '<p>No items found on this invoice.</p>';
            }
        });
        
        // Function to send invoice to email
        function sendInvoiceToEmail() {
            const invoiceData = localStorage.getItem('lastInvoice');
            if (!invoiceData) {
                alert('No invoice found. Please complete a checkout first.');
                return;
            }
            
            const invoice = JSON.parse(invoiceData);
            const userEmail = localStorage.getItem('userEmail') || '';
            
            // Create email content
            let emailBody = 'Thank you for your purchase!\n\n';
            emailBody += '=== INVOICE DETAILS ===\n';
            emailBody += 'Company: ' + invoice.companyName + '\n';
            emailBody += 'Invoice Number: ' + invoice.invoiceNumber + '\n';
            emailBody += 'Date: ' + new Date(invoice.date).toLocaleString() + '\n';
            emailBody += 'TRN: ' + invoice.trn + '\n\n';
            
            if (invoice.shippingInformation) {
                emailBody += '=== SHIPPING INFORMATION ===\n';
                emailBody += 'Name: ' + invoice.shippingInformation.name + '\n';
                emailBody += 'Address: ' + invoice.shippingInformation.address + '\n';
                emailBody += 'City: ' + invoice.shippingInformation.city + '\n';
                emailBody += 'Postal Code: ' + invoice.shippingInformation.postal + '\n\n';
            }
            
            emailBody += '=== PURCHASED ITEMS ===\n';
            for (let i = 0; i < invoice.items.length; i++) {
                const item = invoice.items[i];
                emailBody += item.name + ' (x' + item.quantity + ') @ $' + item.price.toFixed(2) + ' = $' + (item.price * item.quantity).toFixed(2) + '\n';
            }
            
            emailBody += '\n=== FINANCIAL SUMMARY ===\n';
            emailBody += 'Subtotal: $' + invoice.subtotal.toFixed(2) + '\n';
            emailBody += 'Discount: $' + invoice.discount.toFixed(2) + '\n';
            emailBody += 'Tax: $' + invoice.taxes.toFixed(2) + '\n';
            emailBody += 'Total Cost: $' + invoice.totalCost.toFixed(2) + '\n';
            emailBody += 'Amount Paid: $' + invoice.amountPaid.toFixed(2) + '\n';
            
            // Encode for URL
            const subject = encodeURIComponent('Invoice ' + invoice.invoiceNumber + ' from Apex Technologies');
            const body = encodeURIComponent(emailBody);
            
            // Open default email client
            window.location.href = 'mailto:' + userEmail + '?subject=' + subject + '&body=' + body;
            
            alert('Opening your email client to send invoice. Please click "Send" in your email application.');
        }
    </script>
</body>
</html>


